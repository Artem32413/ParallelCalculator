# Калькулятор


## Распределённый вычислитель арифметических выражений
___
[![Typing SVG](https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=21&pause=10000&color=00D7FF&repeat=false&width=530&lines=%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA+%D0%B8+%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0+%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0)](https://git.io/typing-svg)

Для запуска программы можно использовать команду для make файла:
>make

а для завершения работы make файла используй команду:
>kill
>
Или в двух разных командных строках последовательно прописать:
>go run cmd/Orchestrator/main.go
>
>go run cmd/Agent/main.go 
>
___
[![Typing SVG](https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=21&pause=10000&color=00D7FF&repeat=false&width=530&lines=%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80+%D0%B2%D0%B2%D0%BE%D0%B4%D0%B0++%D1%81+%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E+Postman)](https://git.io/typing-svg)

У сервиса 1 endpoint с url-ом /api/v1/calculate. Отправим на этот url POST-запрос с телом:
```json
{
    "expression": "2+2"
}
```
В ответе получаем HTTP-ответ с телом:
```json
{
    "id": "1"
}
```
>и кодом 201, если выражение добавлено в очередь для разбивки на действия

>и кодом 422, если входные данные не соответствуют требованиям приложения — например, кроме цифр и разрешённых операций ты ввёл символ английского алфавита.


>и код 500 в случае какой-либо иной ошибки («Что-то пошло не так»).
Тело ответа
```json
{
    "expressions": [
        {
            "id": <идентификатор выражения>,
            "status": <статус вычисления выражения>,
            "result": <результат выражения>
        },
        {
            "id": <идентификатор выражения>,
            "status": <статус вычисления выражения>,
            "result": <результат выражения>
        }
    ]
}
```
Коды ответа:

>200 - успешно получен список выражений
>500 - что-то пошло не так

Получение выражения по его идентификатору

#### curl --location 'localhost/api/v1/expressions/:id'
Коды ответа:

>200 - успешно получено выражение
404 - нет такого выражения
500 - что-то пошло не так

Тело ответа
```json
{
    "expression":
        {
            "id": <идентификатор выражения>,
            "status": <статус вычисления выражения>,
            "result": <результат выражения>
        }
}
```
Получение задачи для выполнения
#### curl --location 'localhost/internal/task'
Коды ответа:

>200 - успешно получена задача
404 - нет задачи
500 - что-то пошло не так

Тело ответа
```json
{
    "task":
        {
            "id": <идентификатор задачи>,
            "arg1": <имя первого аргумента>,
            "arg2": <имя второго аргумента>,
            "operation": <операция>,
            "operation_time": <время выполнения операции>
        }
}
```
Прием результата обработки данных.

```json
 curl --location 'localhost/internal/task' \
 --header 'Content-Type: application/json' \
 --data '{
  "id": 1,
  "result": 2.5
 }'
 ```
Коды ответа:

>200 - успешно записан результат
404 - нет такой задачи
422 - невалидные данные
500 - что-то пошло не так
____
[![Typing SVG](https://readme-typing-svg.demolab.com?font=Fira+Code&pause=1000&repeat=false&height=70&lines=%D0%92%D1%80%D0%B5%D0%BC%D1%8F+%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F+%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B9+)](https://git.io/typing-svg)
>Время выполнения операций (в миллисекундах) хранится в .env файле 

```TIME_ADDITION_MS```: время выполнения сложения(задержка при сложении). В миллисекундах. Принимает любое неотрицательное целое значение. В переменной  это 2000

```TIME_SUBTRACTION_MS```: время выполнения вычитания(задержка при вычитании). В миллисекундах. Принимает любое неотрицательное целое значение. В переменной  это 2000

```TIME_MULTIPLICATIONS_MS```: время выполнения умножения(задержка при умножении). В миллисекундах. Принимает любое неотрицательное целое значение. В переменной  это 3000

```TIME_DIVISIONS_MS```: время выполнения деления(задержка при делении). В миллисекундах. Принимает любое неотрицательное целое значение. В переменной  это 3000
___
[![Typing SVG](https://readme-typing-svg.demolab.com?font=Fira+Code&pause=1000&repeat=false&height=70&lines=%D0%9E%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5+%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B+%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0)](https://git.io/typing-svg)

Пользователь отправляет пример 6 + 2 - 2 / (3 * 10) в ```Оркестратор```. Оркестратор начинает разделять пример на действия (подзадачи) и кладет каждую последовательно в очередь. ```Агент``` постоянно запрашивает задачи у оркестратора и начинает вычисление. Действия происходят паралельно, что позволяет принимать большое количество запросов, которые не будут конфликтовать друг с другом. ```Агент``` после расчета последовательных действий кидает Post запрос обратно в ```Оркестратор```. После этого можно видеть все результаты по пути ```http://localhost:8080/api/v1/expressions/``` или конкретное значение по пути ```http://localhost:8080/api/v1/expressions/:id```. Чтобы видеть последовательные действия нужно открыть ```http://localhost:8080/internal/task/```.

![alt text](https://raw.githubusercontent.com/Artem32413/block/refs/heads/main/diagram.png)
___